## hcm审计说明文档

HCM审计分为以下几种：
1. 云资源申请审计
2. 云资源创建审计
3. HCM私有资源创建审计 
4. 云资源属性更新审计 
5. HCM私有资源属性更新审计 
6. 云资源删除审计 
7. HCM私有资源删除审计 
8. 云资源关联操作类审计

因为部分操作涉及同时操作云上资源数据和HCM资源数据的场景，且无法使该操作变为原子操作。其次，
为了避免操作无法追踪，审计采用宁可多记，避免漏记的原则。

### 云资源创建审计/HCM私有资源创建审计
对于资源创建审计是在dal/dao中，和对应资源创建逻辑在一起。因为，审计信息中有资源ID，无法在创建资源前获取到该信息。
如果等资源创建成功后，再去记录审计，会存在审计失败，但资源已经在hcm创建成功的情况，违反审计原则。

但会存在一种情况是云上资源创建成功，但HCM资源创建失败且没有审计的情况。但因为资源数据没有落入hcm，
所以用户也无法通过hcm来操作该资源，是想对安全的一种选择。

### 云资源属性更新审计/HCM私有资源属性更新审计/云资源删除审计/HCM私有资源删除审计/云资源关联操作类审计
对于云资源的操作链路是 cloud_server -> hc_service -> data_service。
对于非云资源的操作链路是 cloud_server -> data_service。
且为了避免操作云资源成功，但审计没有记录的情况存在，所以云资源审计必须在 cloud_server 或者 hc_service 去做。但如果选择 hc_service 去做的话，
会导致云资源云属性审计在 hc_service，但如业务ID这些非云资源属性的操作审计却在 cloud_server，审计逻辑太分散不太方便管理。
所以，最终选择统一在cloud_server做（云资源属性更新审计/HCM私有资源属性更新审计/云资源删除审计/HCM私有资源删除审计/云资源关联操作类审计）审计。

### 云资源申请审计
TODO: 之后申请开发同学根据实际逻辑，决定如何选择，口子是都有的。
1. 可以放到 cloud_server 去掉 data-service 创建审计接口，做场景审计。
2. 放到 dal/dao 中，与异步任务绑定。
